'use strict';var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6-impl","es3");
var staticCache="foodz-cache-v1",imgCache="foodz-imgs-cache-v1",CURRENT_CACHES=[staticCache,imgCache],staticPrecache="/app-shell.html /partial/recipe.html /partial/recipes.html /partial/new-recipe.html /css/app-shell.css /css/new-recipe.css /css/noscript.css /css/recipe.css /css/recipes.css /js/app.js /js/recipe.js /js/validate.js /images/pencil.svg /manifest.json /icons/favicon.ico".split(" "),sw={};self.oninstall=function(a){a.waitUntil(caches.open(staticCache).then(function(a){return a.addAll(staticPrecache)}).then(function(){return self.skipWaiting()}))};
self.onactivate=function(a){a.waitUntil(caches.keys().then(function(a){return Promise.all(a.filter(function(a){return CURRENT_CACHES.includes(a)?a:caches.delete(a)})).then(function(){database.init().then(function(){console.log("database loaded!");sw.syncToServer()})}).then(function(){self.clients.claim()}).catch(function(a){console.error(a)})}))};
sw.syncToServer=function(a){return new Promise(function(){navigator.online&&(a?fetch("/sync",{method:"POST",body:a}):database.getAll(function(a){fetch("/sync",{method:"POST",body:a})}))})};sw.renderTemplate=function(a,b){return template.render(a,b).then(function(a){return new Response(a,{headers:{"Content-Type":"text/html"}})}).catch(function(a){console.error("renderTemplate error",a)})};sw.formatSteps=function(a){a=a.split("*");""==a[0]&&(a=a.slice(1));return a.map(function(a){return a.trim()})};
sw.createSteps=function(a){return"* "+a.join("\n* ")};
sw.matchEndpoint=function(a,b){var c=a.referrer||"/recipes";return new Promise(function(a){if(b.match(/(\/|\/recipes)$/))return database.getAll().then(function(b){return sw.renderTemplate("/app-shell.html",{locals:{pageName:"Recipes",recipeList:b,headerBtn:"",stylesheets:["css/recipes.css"],scripts:[]},partials:{page:"/partial/recipes.html"}}).then(function(b){return a(b)})});if(b.match(/\/recipe\/.*/)){var e=b.substr(8);return database.get(e).then(function(b){return sw.renderTemplate("/app-shell.html",{locals:{pageName:"Recipe",
id:b.id,picture:b.picture,title:b.title,time:b.time,difficulty:b.difficulty,description:b.description,ingredients:b.ingredients,directions:b.directions,actionBtn:"edit",headerBtn:"/recipes",scripts:["/js/recipe.js"],stylesheets:["/css/app-shell.css","/css/recipe.css"]},partials:{page:"/partial/recipe.html"}}).then(function(b){return a(b)})})}if(b.match(/\/(new-recipe$)/))return sw.renderTemplate("/app-shell.html",{locals:{pageName:"New Recipe",r:{id:0,title:"",picture:"",title:"",time:"",difficulty:0,
description:"",ingredients:"",directions:""},headerBtn:"",scripts:["js/validate.js"],stylesheets:["css/new-recipe.css"]},partials:{page:"/partial/new-recipe.html"}}).then(function(b){return a(b)});if(b.match(/\/edit\/.*/)){var f=b.substr(6);return database.get(f).then(function(b){b=JSON.parse(JSON.stringify(b));b.id=f;b.ingredients=sw.createSteps(b.ingredients);b.directions=sw.createSteps(b.directions);return sw.renderTemplate("/app-shell.html",{locals:{pageName:"Edit Recipe",r:b,headerBtn:c,scripts:["/js/validate.js"],
stylesheets:["/css/app-shell.css","/css/new-recipe.css"]},partials:{page:"/partial/new-recipe.html"}}).then(function(b){return a(b)})})}return a(void 0)})};sw.serveStatic=function(a,b,c){return caches.open(b).then(function(b){return b.match(a).then(function(b){return b||sw.matchEndpoint(a,c).then(function(b){new Headers;return b||fetch(a).then(function(a){return a})})})}).catch(function(a){console.error("SW fetch error",a)})};
function makeUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})}sw.readFormBody=function(a){return a.text().then(function(a){var c={};a.split("&").reduce(function(a,b){var c=$jscomp.makeIterator(b.split("="));b=c.next().value;c=c.next().value;c=decodeURIComponent(c);"picture"!=b&&(c=c.replace(/\+/g," ").replace(/%0D%0A/g,"").replace(/%3A/g,":"));a[b]=c;return a},c);return c})};
sw.postRequest=function(a){var b=a.url;if(b.match(/\/new-recipe/))return sw.readFormBody(a).then(function(a){console.log("recipe",a);a.id=makeUUID();a.ingredients=sw.formatSteps(a.ingredients);a.directions=sw.formatSteps(a.directions);return database.add(a).then(function(){return Response.redirect("/recipes",302)})});if(b.match(/\/edit\/.*/)){var c=b.split(/edit\//)[1];return sw.readFormBody(a).then(function(a){a.id=c;a.ingredients=sw.formatSteps(a.ingredients);a.directions=sw.formatSteps(a.directions);
return database.update(a).then(function(){return Response.redirect("/recipes",302)})})}if(b.match(/\/recipe\/.*/))return c=(new URL(a.url)).pathname.substr(8),database.delete(c).then(function(){return Response.redirect("/recipes",302)})};self.onfetch=function(a){var b=a.request;if("GET"===b.method){var c=new URL(b.url);c.origin===location.origin?a.respondWith(sw.serveStatic(b,staticCache,c.pathname)):a.respondWith(sw.serveStatic(b,imgCache,""))}else"POST"===b.method&&a.respondWith(sw.postRequest(b))};
var template={interpolate:function(a,b,c){return(new (Function.prototype.bind.apply(Function,[null].concat($jscomp.arrayFromIterable(b),["return `"+a+"`;"])))).apply(null,[].concat($jscomp.arrayFromIterable(c)))},readPartial:function(a){return new Promise(function(b){caches.open(staticCache).then(function(c){return c.match(a).then(function(b){return b||fetch(a)}).then(function(a){return a.text().then(function(a){return b(a)})})}).catch(function(a){console.error("readPartial error",a)})})},render:function(a,
b){return new Promise(function(c){var d=[],e=Object.keys(b.locals).map(function(a){d.push(a);return b.locals[a]}),f=Object.keys(b.partials),d=d.concat(f);return Promise.all(f.map(function(a){return template.readPartial(b.partials[a])})).then(function(b){var f=e.concat(b);e=e.concat(b.map(function(a){return template.interpolate(a,d,f)}));return template.readPartial(a).then(function(a){a=template.interpolate(a,d,e);return c(a)})})})}},database={init:function(){return new Promise(function(a){if(!self.db){var b=
indexedDB.open("foodz-db");b.onerror=function(a){console.error("db error",a.target.errorCode)};b.onsuccess=function(){self.db=b.result;a(self.db)};b.onupgradeneeded=function(a){a.target.result.createObjectStore("recipes",{keyPath:"id"}).createIndex("id","id",{unique:!0})}}})},get:function(a){return new Promise(function(b){self.db.transaction(["recipes"]).objectStore("recipes").get(a).onsuccess=function(a){b(a.target.result)}})},add:function(a){return new Promise(function(b){self.db.transaction(["recipes"],
"readwrite").objectStore("recipes").add(a).onsuccess=function(a){b(a.target.result)}})},update:function(a){return new Promise(function(b){self.db.transaction(["recipes"],"readwrite").objectStore("recipes").put(a).onsuccess=function(a){b(a.target.result)}})},getAll:function(){var a=[];return new Promise(function(b){self.db.transaction(["recipes"]).objectStore("recipes").index("id").openCursor().onsuccess=function(c){(c=c.target.result)?(a.push(c.value),c.continue()):b(a)}})},delete:function(a){return new Promise(function(b){self.db.transaction(["recipes"],
"readwrite").objectStore("recipes").delete(a).onsuccess=function(a){b(a.target.result)}})}};
