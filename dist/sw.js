'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var e=b.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=b[c];if(f===a||Object.is(f,a))return!0}return!1}},"es7","es3");
var staticCache="foodz-cache-v3",imgCache="foodz-imgs-cache-v1",CURRENT_CACHES=[staticCache,imgCache],staticPrecache="/app-shell.html /css/app-shell.css /css/new-recipe.css /css/noscript.css /css/recipe.css /css/recipes.css /css/settings.css /js/app.js /js/recipe.js /js/validate.js /js/push.js /partial/new-recipe.html /partial/recipe.html /partial/recipes.html /partial/settings.html /images/pencil.svg /icons/favicon.ico".split(" "),sw={};self.oninstall=function(a){a.waitUntil(caches.open(staticCache).then(function(a){return a.addAll(staticPrecache)}).then(function(){return self.skipWaiting()}))};
self.onactivate=function(a){a.waitUntil(caches.keys().then(function(a){return Promise.all(a.filter(function(a){return CURRENT_CACHES.includes(a)?a:caches.delete(a)})).then(function(){database.init().then(function(){sw.syncToServer()})}).then(function(){self.clients.claim()}).catch(function(a){console.error(a)})}))};sw.syncToServer=function(a){return new Promise(function(){navigator.online&&(a?fetch("/sync",{method:"POST",body:a}):database.getAll(function(a){fetch("/sync",{method:"POST",body:a})}))})};
sw.renderTemplate=function(a,b){return template.render(a,b).then(function(a){return new Response(a,{headers:{"Content-Type":"text/html"}})}).catch(function(a){console.error("renderTemplate error",a)})};sw.formatSteps=function(a){a=a.split("*");""==a[0]&&(a=a.slice(1));return a.map((a)=>a.trim())};sw.createSteps=function(a){return"* "+a.join("\n* ")};
sw.matchEndpoint=function(a,b){var c=a.referrer||"/recipes";return new Promise(function(a){if(b.match(/(\/|\/recipes)$/))return database.getAll().then(function(b){return sw.renderTemplate("/app-shell.html",{locals:{pageName:"Recipes",recipeList:b,headerBtn:"",stylesheets:["css/recipes.css"],scripts:[]},partials:{page:"/partial/recipes.html"}}).then((b)=>a(b))});if(b.match(/\/recipe\/.*/)){let c=b.substr(8);return database.get(c).then(function(b){return sw.renderTemplate("/app-shell.html",{locals:{pageName:"Recipe",
id:b.id,picture:b.picture,title:b.title,time:b.time,difficulty:b.difficulty,description:b.description,ingredients:b.ingredients,directions:b.directions,actionBtn:"edit",headerBtn:"/recipes",scripts:["/js/recipe.js"],stylesheets:["/css/app-shell.css","/css/recipe.css"]},partials:{page:"/partial/recipe.html"}}).then(function(b){return a(b)})})}if(b.match(/\/(new-recipe$)/))return sw.renderTemplate("/app-shell.html",{locals:{pageName:"New Recipe",r:{id:0,title:"",picture:"",time:"",difficulty:0,description:"",
ingredients:"",directions:""},headerBtn:"",scripts:["js/validate.js"],stylesheets:["css/new-recipe.css"]},partials:{page:"/partial/new-recipe.html"}}).then(function(b){return a(b)});if(b.match(/\/edit\/.*/)){let d=b.substr(6);return database.get(d).then(function(b){b=JSON.parse(JSON.stringify(b));b.id=d;b.ingredients=sw.createSteps(b.ingredients);b.directions=sw.createSteps(b.directions);return sw.renderTemplate("/app-shell.html",{locals:{pageName:"Edit Recipe",r:b,headerBtn:c,scripts:["/js/validate.js"],
stylesheets:["/css/app-shell.css","/css/new-recipe.css"]},partials:{page:"/partial/new-recipe.html"}}).then(function(b){return a(b)})})}return a(void 0)})};sw.serveStatic=function(a,b,c){return caches.open(b).then(function(b){return b.match(a).then(function(b){return b||sw.matchEndpoint(a,c).then(function(b){new Headers;return b||fetch(a).then((a)=>a)})})}).catch(function(a){console.error("SW fetch error",a)})};
function makeUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})}sw.readFormBody=function(a){return a.text().then(function(a){var b={};a.split("&").reduce((a,b)=>{let [c,d]=b.split("=");b=decodeURIComponent(d);"picture"!=c&&(b=b.replace(/\+/g," ").replace(/%0D%0A/g,"").replace(/%3A/g,":"));a[c]=b;return a},b);return b})};
sw.postRequest=function(a){var b=a.url;if(b.match(/\/new-recipe/))return sw.readFormBody(a).then(function(a){a.id=makeUUID();a.ingredients=sw.formatSteps(a.ingredients);a.directions=sw.formatSteps(a.directions);return database.add(a).then(()=>Response.redirect("/recipes",302))});if(b.match(/\/edit\/.*/)){var c=b.split(/edit\//)[1];return sw.readFormBody(a).then(function(a){a.id=c;a.ingredients=sw.formatSteps(a.ingredients);a.directions=sw.formatSteps(a.directions);return database.update(a).then(()=>
Response.redirect("/recipes",302))})}if(b.match(/\/recipe\/.*/))return a=(new URL(a.url)).pathname.substr(8),database.delete(a).then(()=>Response.redirect("/recipes",302))};self.onfetch=function(a){var b=a.request;if("GET"===b.method){var c=new URL(b.url);c.origin===location.origin?a.respondWith(sw.serveStatic(b,staticCache,c.pathname)):a.respondWith(sw.serveStatic(b,imgCache,""))}else"POST"===b.method&&a.respondWith(sw.postRequest(b))};
sw.getMessage=function(){var a=["Awesome recipe incoming","Check out your new recipe"];return a[Math.floor(Math.random()*a.length)]};self.addEventListener("push",function(a){var b=sw.getMessage();a.waitUntil(self.registration.showNotification("Yum Foodz",{body:b,icon:"icons/favicon-32x32.png",vibrate:[100,200,100,200]}))});
self.addEventListener("notificationclick",function(a){a.notification.close();a.waitUntil(clients.matchAll().then(function(a){for(var b=0;b<a.length;b++){var d=a[b];if(d.url.match(/\/fotd/)&&"focus"in d)return d.focus()}if(clients.openWindow)return clients.openWindow("/fotd")}))});
var template={interpolate:(a,b,c)=>(new Function(...b,"return `"+a+"`;"))(...c),readPartial:function(a){return new Promise((b)=>{caches.open(staticCache).then((c)=>c.match(a).then((b)=>b||fetch(a)).then((a)=>a.text().then((a)=>b(a)))).catch((a)=>{console.error("readPartial error",a)})})},render:function(a,b){return new Promise((c)=>{var d=[],e=Object.keys(b.locals).map((a)=>{d.push(a);return b.locals[a]}),f=Object.keys(b.partials);d=d.concat(f);return Promise.all(f.map((a)=>template.readPartial(b.partials[a]))).then((b)=>
{var f=e.concat(b);e=e.concat(b.map((a)=>template.interpolate(a,d,f)));return template.readPartial(a).then((a)=>{a=template.interpolate(a,d,e);return c(a)})})})}},database={init:function(){return new Promise(function(a){if(!self.db){var b=indexedDB.open("foodz-db");b.onerror=function(a){console.error("db error",a.target.errorCode)};b.onsuccess=function(){self.db=b.result;a(self.db)};b.onupgradeneeded=function(a){a.target.result.createObjectStore("recipes",{keyPath:"id"}).createIndex("id","id",{unique:!0})}}})},
get:function(a){return new Promise(function(b){self.db.transaction(["recipes"]).objectStore("recipes").get(a).onsuccess=function(a){b(a.target.result)}})},add:function(a){return new Promise(function(b){self.db.transaction(["recipes"],"readwrite").objectStore("recipes").add(a).onsuccess=function(a){b(a.target.result)}})},update:function(a){return new Promise(function(b){self.db.transaction(["recipes"],"readwrite").objectStore("recipes").put(a).onsuccess=function(a){b(a.target.result)}})},getAll:function(){var a=
[];return new Promise(function(b){self.db.transaction(["recipes"]).objectStore("recipes").index("id").openCursor().onsuccess=function(c){(c=c.target.result)?(a.push(c.value),c.continue()):b(a)}})},delete:function(a){return new Promise(function(b){self.db.transaction(["recipes"],"readwrite").objectStore("recipes").delete(a).onsuccess=function(a){b(a.target.result)}})}};
